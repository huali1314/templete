{"version":3,"sources":["../../../../assets/Script/assets/Script/JoystickBG.js"],"names":["Common","require","cc","Class","extends","Component","properties","dot","default","type","Node","displayName","_joyCom","_playerNode","_angle","_radian","_speed","_speed1","_speed2","_opacity","onLoad","distance","node","parent","getComponent","sprite","penguinCtrl","isTouching","canvas","find","touchPanel","getChildByName","touchType","TouchType","DEFAULT","_initTouchEvent","self","on","EventType","TOUCH_START","_touchDotStartEvent","TOUCH_END","_touchDotEndEvent","TOUCH_CANCEL","_touchListener","setSwallowTouches","_touchStartEvent","TOUCH_MOVE","_touchMoveEvent","_touchEndEvent","event","moveStart","moveEnd","update","dt","directionType","DirectionType","FOUR","_fourDirectionsMove","EIGHT","_eightDirectionsMove","ALL","_allDirectionsMove","y","x","move","_getDistance","pos1","pos2","Math","sqrt","pow","_getRadian","point","PI","_getAngle","pos","getPosition","atan2","_setSpeed","touchPos","convertToNodeSpaceAR","getLocation","p","radius","width","_stickPos","posX","posY","setPosition","cos","sin","log"],"mappings":"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","file":"JoystickBG.js","sourceRoot":"../../../../assets/Script","sourcesContent":["var Common = require('JoystickBar');\ncc.Class({\n    extends: cc.Component,\n \n    properties: {\n        dot: {\n            default: null,\n            type: cc.Node,\n            displayName: '摇杆节点',\n        },\n        _joyCom: {\n            default: null,\n            displayName: 'joy Node',\n \n        },\n        _playerNode: {\n            default: null,\n            displayName: '被操作的目标Node',\n        },\n        _angle: {\n            default: null,\n            displayName: '当前触摸的角度',\n \n        },\n        _radian: {\n            default: null,\n            displayName: '弧度',\n        },\n \n \n        _speed: 0, //实际速度\n        _speed1: 2, //一段速度\n        _speed2: 4, //二段速度\n        _opacity: 0, //透明度\n    },\n \n \n    onLoad: function () {\n        this.distance = 0\n        // joy下的Joystick组件\n        this._joyCom = this.node.parent.getComponent('Joystick');\n        // Joystick组件下的player节点\n        this._playerNode = this._joyCom.sprite;\n        this.penguinCtrl = this._playerNode.getComponent(\"penguinCtrl\")\n        this.isTouching = false\n        this.canvas = cc.find(\"Canvas\")\n        this.touchPanel = this.canvas.getChildByName(\"touchPanel\")\n        if (this._joyCom.touchType == Common.TouchType.DEFAULT) {\n            //对圆圈的触摸监听\n            this._initTouchEvent();\n        }\n    },\n \n \n    //对圆圈的触摸监听\n    _initTouchEvent: function () {\n        var self = this;\n        self.dot.on(cc.Node.EventType.TOUCH_START, this._touchDotStartEvent, self);\n        self.dot.on(cc.Node.EventType.TOUCH_END, this._touchDotEndEvent, self);\n        self.dot.on(cc.Node.EventType.TOUCH_CANCEL, this._touchDotEndEvent, self);\n        self.dot._touchListener.setSwallowTouches(false)\n        self.node.on(cc.Node.EventType.TOUCH_START, this._touchStartEvent, self);\n \n        self.node.on(cc.Node.EventType.TOUCH_MOVE, this._touchMoveEvent, self);\n \n        // 触摸在圆圈内离开或在圆圈外离开后，摇杆归位，player速度为0\n        self.node.on(cc.Node.EventType.TOUCH_END, this._touchEndEvent, self);\n        self.node.on(cc.Node.EventType.TOUCH_CANCEL, this._touchEndEvent, self);\n\n        // this.touchPanel.on(cc.Node.EventType.TOUCH_START, this._touchPanelStartEvent, this);\n        // this.touchPanel.on(cc.Node.EventType.TOUCH_END, this._touchPanelEndEvent, this);\n        // this.touchPanel.on(cc.Node.EventType.TOUCH_CANCEL, this._touchPanelCanelEvent, this);\n    },\n    // _touchPanelStartEvent: function (event) {\n    //     this.penguinCtrl.jump()\n    //     this.penguinCtrl.attack()\n    // },\n    // _touchPanelEndEvent: function (event) {\n    //     this.jsJumpInPlane = false\n    // },\n    // _touchPanelCanelEvent: function (event) {\n    //     this.jsJumpInPlane = false\n    // },\n    _touchDotStartEvent: function (event) {\n        this.penguinCtrl.moveStart()\n    },\n    _touchDotEndEvent: function (event) {\n        this.penguinCtrl.moveEnd()\n    },\n    //更新移动目标\n    update: function (dt) {\n        if (this.isTouching == true){\n            switch (this._joyCom.directionType) {\n            case Common.DirectionType.FOUR:\n                this._fourDirectionsMove();\n                break;\n            case Common.DirectionType.EIGHT:\n                this._eightDirectionsMove();\n                break;\n            case Common.DirectionType.ALL:\n                this._allDirectionsMove();\n                break;\n            default:\n                break;\n            }\n        }\n    },\n    //四个方向移动(上下左右)  \n    _fourDirectionsMove: function () {\n        if (this._angle > 45 && this._angle < 135) {\n            this._playerNode.y += this._speed;\n        } else if (this._angle > -135 && this._angle < -45) {\n            this._playerNode.y -= this._speed;\n        } else if (this._angle < -135 && this._angle > -180 || this._angle > 135 && this._angle < 180) {\n            this._playerNode.x -= this._speed;\n        } else if (this._angle < 0 && this._angle > -45 || this._angle > 0 && this._angle < 45) {\n            this._playerNode.x += this._speed;\n        }\n    },\n \n    //八个方向移动(上下左右、左上、右上、左下、右下)  \n    _eightDirectionsMove: function () {\n        if (this._angle > 67.5 && this._angle < 112.5) {\n            this._playerNode.y += this._speed;\n        } else if (this._angle > -112.5 && this._angle < -67.5) {\n            this._playerNode.y -= this._speed;\n        } else if (this._angle < -157.5 && this._angle > -180 || this._angle > 157.5 && this._angle < 180) {\n            this._playerNode.x -= this._speed;\n        } else if (this._angle < 0 && this._angle > -22.5 || this._angle > 0 && this._angle < 22.5) {\n            this._playerNode.x += this._speed;\n        } else if (this._angle > 112.5 && this._angle < 157.5) {\n            this._playerNode.x -= this._speed / 1.414;\n            this._playerNode.y += this._speed / 1.414;\n        } else if (this._angle > 22.5 && this._angle < 67.5) {\n            this._playerNode.x += this._speed / 1.414;\n            this._playerNode.y += this._speed / 1.414;\n        } else if (this._angle > -157.5 && this._angle < -112.5) {\n            this._playerNode.x -= this._speed / 1.414;\n            this._playerNode.y -= this._speed / 1.414;\n        } else if (this._angle > -67.5 && this._angle < -22.5) {\n            this._playerNode.x += this._speed / 1.414;\n            this._playerNode.y -= this._speed / 1.414;\n        }\n    },\n    //全方向移动\n    _allDirectionsMove: function () {\n        this.penguinCtrl.move(this._angle,this.distance)\n    },\n    //计算两点间的距离并返回\n    _getDistance: function (pos1, pos2) {\n        return Math.sqrt(Math.pow(pos1.x - pos2.x, 2) +\n            Math.pow(pos1.y - pos2.y, 2));\n    },\n \n    /*角度/弧度转换\n    角度 = 弧度 * 180 / Math.PI\n    弧度 = 角度 * Math.PI / 180*/\n    //计算弧度并返回\n    _getRadian: function (point) {\n        this._radian = Math.PI / 180 * this._getAngle(point);\n        return this._radian;\n    },\n \n    //计算角度并返回\n    _getAngle: function (point) {\n \n        var pos = this.node.getPosition();\n        this._angle = Math.atan2(point.y - pos.y, point.x - pos.x) * (180 / Math.PI);\n        return this._angle;\n    },\n \n    //设置实际速度\n    _setSpeed: function (point) {\n        //触摸点和遥控杆中心的距离\n        var distance = this._getDistance(this.dot.getPosition(), this.node.getPosition());\n        this.distance = distance\n        // this._speed = 2;\n    },\n \n    _touchStartEvent: function (event) {\n        // cc.log(\"_touchStartEvent=========\")\n        // cc.director.resume()\n        this.isTouching = true\n        // 获取触摸位置的世界坐标转换成圆圈的相对坐标（以圆圈的锚点为基准）\n        var touchPos = this.node.convertToNodeSpaceAR(event.getLocation());\n        //触摸点与圆圈中心的距离\n        var distance = this._getDistance(touchPos, cc.p(0, 0));\n        //圆圈半径\n        var radius = this.node.width / 2;\n        // 记录摇杆位置，给touch move使用\n        this._stickPos = touchPos;\n        var posX = this.node.getPosition().x + touchPos.x;\n        var posY = this.node.getPosition().y + touchPos.y;\n        //手指在圆圈内触摸,控杆跟随触摸点\n        if (radius > distance) {\n            this.dot.setPosition(cc.p(posX, posY));\n            return true;\n        }\n        return false;\n    },\n \n    _touchMoveEvent: function (event) {\n        // cc.log(\"_touchMoveEvent=========\")\n        var touchPos = this.node.convertToNodeSpaceAR(event.getLocation());\n        var distance = this._getDistance(touchPos, cc.p(0, 0));\n        var radius = this.node.width / 2;\n        // 由于摇杆的postion是以父节点为锚点，所以定位要加上ring和dot当前的位置(stickX,stickY)\n        var posX = this.node.getPosition().x + touchPos.x;\n        var posY = this.node.getPosition().y + touchPos.y;\n        if (radius > distance) {\n            this.dot.setPosition(cc.p(posX, posY));\n        } else {\n            //控杆永远保持在圈内，并在圈内跟随触摸更新角度\n            var x = this.node.getPosition().x + Math.cos(this._getRadian(cc.p(posX, posY))) * radius;\n            var y = this.node.getPosition().y + Math.sin(this._getRadian(cc.p(posX, posY))) * radius;\n            this.dot.setPosition(cc.p(x, y));\n        }\n        //更新角度\n        this._getAngle(cc.p(posX, posY));\n        //设置实际速度\n        this._setSpeed(cc.p(posX, posY));\n \n    },\n \n    _touchEndEvent: function () {\n        cc.log(\"_touchEndEvent======\")\n        this.isTouching = false\n        var pos = this.node.getPosition()\n        this.dot.setPosition(pos);\n        this._speed = 0;\n        this.distance = 0\n        // cc.director.pause()\n    },\n});"]}