{"version":3,"sources":["../../../../assets/Script/assets/Script/penguinCtrl.js"],"names":["global","require","penguinConfig","cc","Class","extends","Component","properties","onLoad","level","find","water","getChildByName","rigidBody","node","getComponent","RigidBody","animation","Animation","winSize","director","getWinSize","waterLine","height","scheduler","getScheduler","start","initStatus","initData","dtTime","cacheData","localDataManager","getObject","curLevel","attackPoint","swimRatio","isBitten","isSwimming","switchAnimation","name","currentClip","undefined","play","update","dt","updateGravity","y","gravityScale","isInWater","isGoLeft","angle","isGoTop","moveStart","move","speed","x_offset","Math","cos","PI","y_offset","sin","forceX","forceY","rotation","applyForceToCenter","v2","isInPlane","linearVelocity","scaleX","moveEnd","attack","eventlistener","fire","wake","self","schedule","jump","onBeginContact","contact","other","group","log","tag","onStayContact","onEndContact"],"mappings":"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","file":"penguinCtrl.js","sourceRoot":"../../../../assets/Script","sourcesContent":["var global = require(\"./global\");\nvar penguinConfig = require(\"penguinConfig\")\ncc.Class({\n    extends: cc.Component,\n    properties: {\n        },\n    // LIFE-CYCLE CALLBACKS:\n\n    onLoad () {\n        var level = cc.find(\"level\")\n        var water = level.getChildByName(\"water\")\n        this.rigidBody = this.node.getComponent(cc.RigidBody)\n        this.animation = this.node.getComponent(cc.Animation)\n        this.winSize = cc.director.getWinSize()\n        this.waterLine = water.height/2\n        this.scheduler = cc.director.getScheduler()\n    },\n\n    start () {\n        this.initStatus()\n        this.initData()\n        // this.AudioEngine = this.node.getComponent(\"audioEngineController\")\n    },\n    initData:function(){\n        this.dtTime = 0\n        this.cacheData = global.localDataManager.getObject(\"playerData\")\n        var curLevel = this.cacheData.curLevel\n        this.attackPoint = penguinConfig[curLevel].attackPoint\n        this.swimRatio = penguinConfig[curLevel].swimRatio\n    },\n    initStatus:function(){\n        this.isBitten = false\n        this.isSwimming = false\n        this.switchAnimation(\"idle\")\n    },\n    switchAnimation:function(name){\n        var currentClip = this.animation.currentClip\n        if(currentClip != null && currentClip != undefined){\n            if (currentClip.name == name){\n                return null\n            }\n        }\n        switch(name){\n            case \"idle\":\n                this.animation.play(\"idle\")\n                break;\n            case \"walk\":\n                this.animation.play(\"walk\")\n                break;\n            case \"swim\":\n                this.animation.play(\"swim\")\n                break;\n            case \"jump\":\n                this.animation.play(\"jump\")\n                break;\n        }\n    },\n    update(dt){\n        // if(global.gameData.curGameStatus == 0){\n            this.updateGravity()\n            //食物每秒消耗\n            // this.costSatiety(dt)\n        // }\n        // this.updateZHeight(dt)\n    },\n    // costSatiety:function(dt){\n    //     if (this.dtTime >= 1){\n    //         this.dtTime = 0\n    //         this.satietyCost()\n    //     }else{\n    //         this.dtTime += dt\n    //     }\n    // },\n    updateGravity:function(){\n        if(this.node.y >= this.waterLine){\n            this.rigidBody.gravityScale = 0.6\n        }else{\n            this.rigidBody.gravityScale = 0.01\n        }\n    },\n    isInWater:function(){\n        if(this.node.y >= this.waterLine){\n            return false\n        }\n        return true\n    }, \n    isGoLeft:function(angle){\n        if(angle > -90 && angle <=90){\n            return false\n        }\n        return true\n    },\n    isGoTop:function(angle){\n        if(angle > 0 && angle <=180){\n            return true\n        }\n        return false\n    }, \n    moveStart:function(){\n\n    },\n    move:function(angle,speed){\n        var x_offset = Math.cos(angle * (Math.PI / 180)) * speed/2;\n        var y_offset = Math.sin(angle * (Math.PI / 180)) * speed/2\n        var forceX = x_offset * this.swimRatio\n        var forceY = y_offset * this.swimRatio\n        if(this.isInWater()){\n            this.switchAnimation(\"swim\")\n            this.node.rotation = 90 - angle\n            // this.node.rotation = (x_offset > 0)?90:-90\n            this.rigidBody.applyForceToCenter(cc.v2(forceX,forceY),true)\n        }else if(this.isInPlane){\n            this.node.rotation = 0\n            // this.rigidBody.applyForceToCenter(cc.v2(forceX/5 * 2,0),true)\n            // if(this.isInPlane){\n                this.switchAnimation(\"walk\")\n                this.rigidBody.linearVelocity = cc.v2(x_offset,0)\n            // }\n        }else{\n            this.rigidBody.applyForceToCenter(cc.v2(forceX *0.1,9),true)\n            this.node.rotation = 0\n        }\n        this.node.scaleX = (x_offset > 0)?1:-1\n    },\n    moveEnd:function(){\n        this.switchAnimation(\"idle\")\n    },\n    // satietyCost:function(){\n    //     var satietyCostSp = this.satietyCostSpeed\n    //     //加速情况下多倍消耗食物\n    //     if(this.isAccelerate == true){\n    //         satietyCostSp = this.satietyCostSpeed * 2\n    //     }\n    //     var nextSatiety = this.curSatiety - satietyCostSp\n    //     this.curSatiety = (nextSatiety > 0)?nextSatiety:0\n    // },\n    attack:function(){\n        // if(this.isInWater()){\n            global.eventlistener.fire(\"penguinAttack\",this.attackPoint)\n            this.switchAnimation(\"swimAttack\")\n        // }\n    },\n    // caluSpeedBySatiety:function(){\n    //     return (this.curSatiety/100 - 0.6)\n    // },\n    wake:function(){\n        var self = this\n        this.scheduler.schedule(function(){\n            self.isSwimming = false\n        },this,3,0,0,false)\n    },\n    jump:function(){\n        if(this.isInPlane && !this.isInWater()){\n            this.rigidBody.applyForceToCenter(cc.v2(0,5000),true)\n            this.switchAnimation(\"jump\")\n        }\n        this.isInPlane = false\n    },\n    // onCollisionEnter: function (other) {\n    //     this.canAttack = true\n    // },\n    // onCollisionStay: function(other){\n        \n    // },\n    // onCollisionExit: function () {\n    //     this.canAttack = false\n    // },\n    onBeginContact(contact, self, other) {\n        var group = other.node.group\n        cc.log(self.tag,\"=============tag===\")\n           if(group == \"iceStone\"){\n                \n           }else if(group == \"food\"){\n                // this.eatFood(1)\n           }else if(group == \"plane\" && self.tag == 1991){\n                this.switchAnimation(\"idle\")\n                this.isInPlane = true\n           }else if (group == \"food\"){\n                this.attack()\n           }\n    },\n    onStayContact(contact,self,other){\n\n    },\n    onEndContact(contact,self,other){\n        var group = other.node.group\n        if(group == \"plane\" && self.tag == 1991){\n            this.isInPlane = false\n        }else if(group == \"food\"){\n            this.switchAnimation(\"swim\")\n        }\n    },\n});\n"]}